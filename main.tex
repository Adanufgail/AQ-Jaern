\documentclass[openany,svgnames]{book}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Import Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[svgnames]{xcolor}
\usepackage{blindtext}
\usepackage{comment}
\usepackage{microtype}
\usepackage{cprotectinside}
\usepackage{ulem}
\usepackage{soul}
\usepackage{pbox}
\usepackage{xfp}
\usepackage{xintexpr}
\usepackage{parskip}
\usepackage{geometry}
\usepackage{imakeidx}
\usepackage{multicol}
\usepackage{enumitem}
\usepackage{tabularx}
\usepackage{nameref}
\usepackage{tikz}
\usepackage[sfdefault]{roboto}
\usepackage[most]{tcolorbox}
\usepackage{booktabs}
\usepackage{xtab}
\usepackage{makecell}
\usepackage{wrapfig}
\usepackage{array,ragged2e}
\usepackage{titlesec}
\usepackage{etoolbox}
\usepackage{xparse}
\usepackage{ifthen}
\usepackage{fancyhdr} 

\begin{comment}
\usepackage{wasysym}
\usepackage[english]{babel}
\usepackage[T1]{fontenc}
\usepackage[utf8x]{inputenc}
\usepackage{pict2e}
\usepackage{amsmath}
\usepackage{color,pxfonts,fix-cm}
\usepackage{latexsym}
%\usepackage[mathletters]{ucs}
\end{comment}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package-specific variables
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%%Page Geometry
\geometry{letterpaper, portrait, margin=0.5in}

%%%%Set Indent Width to 0
\setlength{\parindent}{0pt}

%%%%Tcolorbox
\tcbuselibrary{breakable}
\tcbuselibrary{skins}

%%%%Tikz
\usetikzlibrary{tikzmark, shapes.geometric, shapes.arrows, fit, bending}

%%%%imakeidx Indexing

%\makeindex[columns=3]
%\indexsetup{othercode=\small}
%\makeindex[program=makeindex,columns=3,intoc=true,options={-s index_style.ist}]
\makeindex[columns=3,intoc=true,options={-s index_style.ist}]

%\fancyhf{}
\fancyfoot{}
\fancyfoot[RO, LE]{\thepage}
\pagestyle{fancy}
\fancypagestyle{plain}{%
  \fancyhf{}%
  \fancyfoot[RO, LE]{\thepage}%
  \renewcommand{\headrulewidth}{0pt}% Line at the header invisible
  \renewcommand{\footrulewidth}{0.4pt}% Line at the footer visible
}
%\patchcmd{\chapter}{\thispagestyle{plain}}{\thispagestyle{fancy}}{}{}


\hyphenpenalty=9999

\setcounter{chapter}{-1}

\newcolumntype{L}{>{\RaggedRight\arraybackslash}X}
\newcolumntype{Y}{>{\raggedleft\arraybackslash}X}

\setlength\intextsep{0pt}

\newlength{\doublemulticol}
\setlength{\doublemulticol}{0.25cm}

\setlength{\multicolsep}{0pt}%

\setlist{nosep,topsep=0pt,leftmargin=12pt}
\setul{1pt}{.4pt}

\setlength{\aboverulesep}{-1pt}
\setlength{\belowrulesep}{2pt}

\raggedbottom

\def\defcolwidth{0.6cm}
\def\aq{\textbf{Adventure Quest }}


\makeatletter
\def\SOUL@hlpreamble{%
    \setul{\dp\strutbox}{\dimexpr\ht\strutbox+\dp\strutbox\relax}%
    \let\SOUL@stcolor\SOUL@hlcolor
    \SOUL@stpreamble
}
\makeatother

\newenvironment{nscenter}
 {\parskip=0pt\par\nopagebreak\centering}
 {\par\noindent\ignorespacesafterend}


\setcounter{secnumdepth}{5}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Indexing Functions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% \indy

\makeatletter
\DeclareDocumentCommand \indy { s o m } {%
  \IfNoValueTF{#2}{%
    \lowercase{\def\temp{#3}}%
    \index{\temp}%
    \ifthenelse{\equal{\f@series}{b}}{\ul{#3}\xspace}{\textbf{#3}}%
  }{%
    \lowercase{\def\temp{#2}}%
    \index{\temp}%
    \ifthenelse{\equal{\f@series}{b}}{\ul{#3}\xspace}{\textbf{#3}}%
  }%
  \IfBooleanTF{#1}{}{\xspace}%
}

%%%% \indx

\makeatother
\DeclareDocumentCommand \indx { m } {%
    \lowercase{\def\temp{#1}}%
    \index{\temp}%
}



%%%% Indexing Shortcuts

\DeclareRobustCommand{\STR}{\indy[strength!STR]{STR}}
\DeclareRobustCommand{\INT}{\indy[intelligence!INT]{INT}}
\DeclareRobustCommand{\PER}{\indy[perception!PER]{PER}}
\DeclareRobustCommand{\CSE}{\indy[common sense!CSE]{CSE}}
\DeclareRobustCommand{\HEA}{\indy[health!HEA]{HEA}}
\DeclareRobustCommand{\AGI}{\indy[agility!AGI]{AGI}}
\DeclareRobustCommand{\PWR}{\indy[power!PWR]{PWR}}
\DeclareRobustCommand{\COM}{\indy[comliness!COM]{COM}}
\DeclareRobustCommand{\WIL}{\indy[willpower!WIL]{WIL}}
\DeclareRobustCommand{\DV}{\indy[weapon!defensive value]{DV}}
\DeclareRobustCommand{\CDV}{\indy[combat defense!CDV]{CDV}}
\DeclareRobustCommand{\CM}{\indy[combat modifier!CM]{CM}}
\DeclareRobustCommand{\GDV}{\indy[grapple defense!GDV]{GDV}}
\DeclareRobustCommand{\GM}{\indy[grapple modifier!GM]{GM}}
\DeclareRobustCommand{\MDV}{\indy[missile defense!MDV]{MDV}}
\DeclareRobustCommand{\MM}{\indy[missile modifier!MM]{MM}}
\DeclareRobustCommand{\DP}{\indy[damage points!DP]{DP}}
\DeclareRobustCommand{\EP}{\indy[experience points!EP]{EP}}
\DeclareRobustCommand{\DU}{\indy[divine units!DU]{DU}}
\DeclareRobustCommand{\EU}{\indy[elemential units!EU]{EU}}
\DeclareRobustCommand{\LF}{\indy[life force!LF]{LF}}
\DeclareRobustCommand{\LOS}{\indy[line of sight!LOS]{LOS}}
\DeclareRobustCommand{\RC}{\indy[resistance check!RC]{RC}}
\DeclareRobustCommand{\DI}{\indy[divine intervention!DI]{DI}}
\DeclareRobustCommand{\ADV}{\indy[Artillery Defense Value!ADV]{ADV}}
\DeclareRobustCommand{\AM}{\indy[Artillery Modifier!AM]{AM}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Colored Highlighting Functions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% Color Definitions

\colorlet{soulGreenYellow}{white!40!GreenYellow}
\colorlet{soulDodgerBlue}{white!60!DodgerBlue}
\colorlet{soulCrimson}{white!50!Crimson}
\colorlet{soulKhaki}{white!50!Khaki}
\colorlet{soulCyan}{white!60!Cyan}
\colorlet{soulLightGreen}{white!40!LightGreen}
\colorlet{soulDarkOrange}{white!80!DarkOrange}
\colorlet{soulGrey}{white!60!Grey}

%%%% Color Box Width

\newlength{\cboxwidth}

%%%% \custhl

\DeclareRobustCommand{\custhl}[2][soulGrey]{%
\pgfmathparse{min(\columnwidth,\textwidth)}%
\setlength{\cboxwidth}{\pgfmathresult pt}%
\sethlcolor{#1}%
\setlength{\fboxsep}{0pt}\colorbox{#1}{%
\pbox{\cboxwidth}{%
\strut{#2}%
}}}

%%%% Highlighting Commands

\DeclareRobustCommand{\tcdieroll}[1]{\custhl[soulGreenYellow]{\textbf{#1}}}
\DeclareRobustCommand{\listing}[1]{\custhl[soulGrey]{\ \textbf{#1}\,}}
\DeclareRobustCommand{\tcpage}[1]{\custhl[soulCrimson]{\textbf{Page \pageref{#1}}}}
\DeclareRobustCommand{\chref}[1]{\custhl[soulCrimson]{\textbf{Ch \ref{#1}: \nameref{#1}}}}
\DeclareRobustCommand{\apref}[1]{\custhl[soulCrimson]{\textbf{Ap \ref{#1}: \nameref{#1}}}}
\DeclareRobustCommand{\chpage}[1]{\chref{#1} on \tcpage{#1}}
\DeclareRobustCommand{\appage}[1]{\apref{#1} on \tcpage{#1}}
\DeclareRobustCommand{\measure}[1]{\custhl[soulKhaki]{\textbf{#1}}}
\DeclareRobustCommand{\result}[1]{\custhl[soulCyan]{\textbf{#1}}}
\DeclareRobustCommand{\quip}[1]{\custhl[soulLightGreen]{\textit{#1}}}
\DeclareRobustCommand{\tcdefine}[1]{\custhl[soulDodgerBlue]{\textbf{#1}}}
\DeclareRobustCommand{\example}[1]{\custhl[soulDarkOrange]{\textit{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Complex Section Building
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% \skillentry

\DeclareRobustCommand{\skillentry}[6]{%
  \def\skilldie{#5}%
  \def\skillindent{10pt}
  \ifthenelse{\equal{\skilldie}{N/A}}{\def\skilldie{#5}}{\ifthenelse{\equal{\skilldie}{RESERVED}}{\def\skilldie{#5}}{\ifthenelse{\equal{\skilldie}{+0}}{\def\skilldie{#5}}{\def\skilldie{+#5}}}}
  \begin{minipage}{\columnwidth}%
  \noindent\rule{\columnwidth}{1pt}%

  \vspace{5pt}
  \begin{tabularx}{\linewidth}{@{} X r}
  \makecell[lt]{\large\textbf{#1}} & 
  \def\tabcolsep{2pt}
  \footnotesize%
  \begin{tabular}{@{}lrlr}%
  Base Cost & \small\textbf{#4 EP} & Attribute & \small\textbf{#2}\\%
  Skill Type & \small\textbf{#3} & Extra Dice & \small\textbf{\skilldie}\\%
  \midrule%
  \end{tabular}\\%
  \end{tabularx}\\%
  \vspace{2pt}

  #6\\%
  \end{minipage}%
  \vspace{5pt}
  \def\tabcolsep{6pt}
}

%%%% \glossary entry

\newcommand{\glossaryentry}[2]{%
  \parbox{3cm}{\listing{\indy*{#1}}}%
  \parbox{\linewidth-3cm}{#2}\par
}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Colored Boxes for Tables
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% normbox

\newtcolorbox{normbox}[1][]{ boxrule=0pt, enhanced, title=\small\textbf{#1}, left=1pt, right=1pt, top=0pt, bottom=-2pt, boxsep=2pt, boxrule=0.6pt, before skip=0.0pt, after skip=0.0pt, lefttitle=2pt, righttitle=2mm, toptitle=1mm, bottomtitle=0mm, minipage boxed title, hbox, colbacktitle=Navy, colback=white}

%%%% normboxc

\newtcolorbox{normboxc}[1][]{%
  boxrule=0pt,%
  enhanced,%
  title=\small\textbf{#1},%
  left=1pt,%
  right=1pt,%
  top=0pt,%
  bottom=0pt,%
  boxsep=2pt,%
  boxrule=0.6pt,%
  before skip=0.5\baselineskip,%
  after skip=0.5\baselineskip,%
  lefttitle=2pt,%
  righttitle=2mm,
  toptitle=1mm,%
  bottomtitle=0mm,%
  minipage boxed title,%
  hbox,%
  colbacktitle=Navy,%
  colback=white,%
  before=\hspace*{\fill},%
  after=\hspace*{\fill},%
  }

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Misc Functions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% \bhead

\newcommand{\bhead}[1]{\thead{\textbf{#1}}}

%%%% \mets

\DeclareDocumentCommand \mets {m O{}}{%
  \def\metfeet{\fpeval{#1*2000}}%
  \def\metmi{\fpeval{round(\metfeet/5280,1)}}%
  \def\mikm{\fpeval{round(\metmi*1.609344,1)}}%
  \xintifboolexpr{\metmi>10}{\def\metmir{\fpeval{round(\metmi,0)}}}{\def\metmir{\metmi}}%
  \xintifboolexpr{\mikm>10}{\def\mikmr{\fpeval{round(\mikm,0)}}}{\def\mikmr{\mikm}}%
  \ifthenelse{\equal{#2}{}}{%
    \measure{#1 mets} (\textit{\metmir mi or \mikmr KM})%
  }%
  {%
    \measure{#1 mets} per \ul{#2} (\textit{\metmir mi or \mikmr KM})%
  }%
}




\begin{document}
\enlargethispage{1.5\baselineskip}
\titleformat{\chapter}[display] {\normalfont\huge\bfseries}{\chaptertitlename\ \thechapter}{20pt}{\Huge}   
\titlespacing*{\chapter}{0pt}{10pt}{10pt}
\titlespacing\section{0pt}{6pt}{6pt}
\titlespacing\subsection{0pt}{6pt }{6pt}
\titlespacing\subsubsection{0pt}{6pt}{6pt}
%\include{test.tex}
%\begin{comment}
\include{titlepage.tex}
\include{copyright.tex}
\include{dedication.tex}
\include{introduction.tex}
\index{gibberish}
\include{changes.tex}
\include{creating-an-adventurer.tex}
\include{playing-an-adventurer.tex}
\include{life-on-the-high-seas.tex}
\include{skills.tex}
\include{onivero.tex}
\include{jaernian-humanoids.tex}
\include{creating-and-playing-actors.tex}
\include{glossary.tex}
\include{important-tables.tex}
\include{earth-references.tex}
%\include{index.tex}
%\end{comment}
\printindex
\end{document}
\documentclass[openany,svgnames]{book}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Import Packages
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\usepackage[svgnames]{xcolor} % Color Names
\usepackage{blindtext}
\usepackage{comment}
\usepackage{microtype}
\usepackage{cprotectinside}
\usepackage{ulem}
\usepackage{soul}
\usepackage{pbox}
\usepackage{xfp}
\usepackage{xintexpr}
\usepackage{parskip}
\usepackage{geometry} % Page Geometry
\usepackage{imakeidx}
\usepackage{multicol}
\usepackage{enumitem}
\usepackage{tabularx}
\usepackage{nameref}
\usepackage{tikz} % Diagramming
\usepackage[sfdefault]{roboto} % Roboto Font
\usepackage[most]{tcolorbox}
\usepackage{booktabs}
\usepackage{xtab}
\usepackage{makecell} % Multiline Table Cells
\usepackage{wrapfig} % Wrap text around images
\usepackage{array,ragged2e}
\usepackage{titlesec}
\usepackage{etoolbox}
\usepackage{xparse}
\usepackage{ifthen} % Better If/Then Handling
\usepackage{fancyhdr} 
\usepackage{tocloft} % Customize ToC

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package-specific variables
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% Page Geometry

\geometry{letterpaper, portrait, margin=0.5in}

%%%% Set Indent Width to 0

\setlength{\parindent}{0pt}

%%%% Tcolorbox

\tcbuselibrary{breakable}
\tcbuselibrary{skins}

%%%% Tikz

\usetikzlibrary{tikzmark, shapes.geometric, shapes.arrows, fit, bending}

%%%% imakeidx Indexing

\makeindex[columns=3,intoc=true,options={-s index_style.ist}]

%%%% Footer

\fancyfoot{}
\fancyfoot[RO, LE]{\thepage}
\pagestyle{fancy}
\fancypagestyle{plain}{%
  \fancyhf{}%
  \fancyfoot[RO, LE]{\thepage}%
  \renewcommand{\headrulewidth}{0pt}% Line at the header invisible
  \renewcommand{\footrulewidth}{0.4pt}% Line at the footer visible
}


%%%% Try not to hypenate

\hyphenpenalty=9999

%%%% Start at Chapter 0

\setcounter{chapter}{-1}

%%%% Create L and Y, for tables

\newcolumntype{L}{>{\RaggedRight\arraybackslash}X}

%%%% 

\setlength\intextsep{0pt}

%%%% Multi Column Width Definitions

\newlength{\doublemulticol}
\setlength{\doublemulticol}{0.25cm}

%%%% Item and Number List Settings

\setlist{nosep,topsep=0pt,leftmargin=12pt}

%%%% Set Underline closer to text
\setul{1pt}{.4pt}

%%%%  Set horizontal rule spacing
\setlength{\aboverulesep}{-1pt}
\setlength{\belowrulesep}{2pt}

%%%% Push text to top of page

\raggedbottom

%%%% Set default column width

\def\defcolwidth{0.6cm}


%%%% 

\makeatletter
\def\SOUL@hlpreamble{%
    \setul{\dp\strutbox}{\dimexpr\ht\strutbox+\dp\strutbox\relax}%
    \let\SOUL@stcolor\SOUL@hlcolor
    \SOUL@stpreamble
}
\makeatother

%%%% New center with no spacing above/below

\newenvironment{nscenter}
 {\parskip=0pt\par\nopagebreak\centering}
 {\par\noindent\ignorespacesafterend}

%%%% 

\setcounter{secnumdepth}{5}

%%%% Set Table of Contents to only show chapters

\setcounter{tocdepth}{0}
\renewcommand{\cftchapleader}{\cftdotfill{\cftdotsep}} % for chapters
\addtocontents{toc}{\protect\setlength{\protect\cftchapnumwidth}{60pt}}
\addtocontents{toc}{\protect\renewcommand{\protect\cftchappresnum}{Chapter }}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Indexing Functions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% \indy

\makeatletter
\DeclareDocumentCommand \indy { s o m } {%
  \IfNoValueTF{#2}{%
    \lowercase{\def\temp{#3}}%
    \index{\temp}%
    \ifthenelse{\equal{\f@series}{b}}{\ul{#3}\xspace}{\textbf{#3}}%
  }{%
    \lowercase{\def\temp{#2}}%
    \index{\temp}%
    \ifthenelse{\equal{\f@series}{b}}{\ul{#3}\xspace}{\textbf{#3}}%
  }%
  \IfBooleanTF{#1}{}{\xspace}%
}

%%%% \indx

\makeatother
\DeclareDocumentCommand \indx { m } {%
    \lowercase{\def\temp{#1}}%
    \index{\temp}%
}

%%%% Indexing Shortcuts

\DeclareRobustCommand{\STR}{\indy[strength!STR]{STR}}
\DeclareRobustCommand{\INT}{\indy[intelligence!INT]{INT}}
\DeclareRobustCommand{\PER}{\indy[perception!PER]{PER}}
\DeclareRobustCommand{\CSE}{\indy[common sense!CSE]{CSE}}
\DeclareRobustCommand{\HEA}{\indy[health!HEA]{HEA}}
\DeclareRobustCommand{\AGI}{\indy[agility!AGI]{AGI}}
\DeclareRobustCommand{\PWR}{\indy[power!PWR]{PWR}}
\DeclareRobustCommand{\COM}{\indy[comliness!COM]{COM}}
\DeclareRobustCommand{\WIL}{\indy[willpower!WIL]{WIL}}
\DeclareRobustCommand{\DV}{\indy[weapon!defensive value]{DV}}
\DeclareRobustCommand{\CDV}{\indy[combat defense!CDV]{CDV}}
\DeclareRobustCommand{\CM}{\indy[combat modifier!CM]{CM}}
\DeclareRobustCommand{\GDV}{\indy[grapple defense!GDV]{GDV}}
\DeclareRobustCommand{\GM}{\indy[grapple modifier!GM]{GM}}
\DeclareRobustCommand{\MDV}{\indy[missile defense!MDV]{MDV}}
\DeclareRobustCommand{\MM}{\indy[missile modifier!MM]{MM}}
\DeclareRobustCommand{\DP}{\indy[damage points!DP]{DP}}
\DeclareRobustCommand{\EP}{\indy[experience points!EP]{EP}}
\DeclareRobustCommand{\DU}{\indy[divine units!DU]{DU}}
\DeclareRobustCommand{\EU}{\indy[elemential units!EU]{EU}}
\DeclareRobustCommand{\LF}{\indy[life force!LF]{LF}}
\DeclareRobustCommand{\LOS}{\indy[line of sight!LOS]{LOS}}
\DeclareRobustCommand{\RC}{\indy[resistance check!RC]{RC}}
\DeclareRobustCommand{\DI}{\indy[divine intervention!DI]{DI}}
\DeclareRobustCommand{\ADV}{\indy[Artillery Defense Value!ADV]{ADV}}
\DeclareRobustCommand{\AM}{\indy[Artillery Modifier!AM]{AM}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Colored Highlighting Functions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% Color Definitions

\colorlet{soulGreenYellow}{white!40!GreenYellow}
\colorlet{soulDodgerBlue}{white!60!DodgerBlue}
\colorlet{soulCrimson}{white!50!Crimson}
\colorlet{soulKhaki}{white!50!Khaki}
\colorlet{soulCyan}{white!60!Cyan}
\colorlet{soulLightGreen}{white!40!LightGreen}
\colorlet{soulDarkOrange}{white!80!DarkOrange}
\colorlet{soulGrey}{white!60!Grey}

%%%% Color Box Width

\newlength{\cboxwidth}

%%%% \custhl

\DeclareRobustCommand{\custhl}[2][soulGrey]{%
\pgfmathparse{min(\columnwidth,\textwidth)}%
\setlength{\cboxwidth}{\pgfmathresult pt}%
\sethlcolor{#1}%
\setlength{\fboxsep}{0pt}\colorbox{#1}{%
\pbox{\cboxwidth}{%
\strut{#2}%
}}}

%%%% Highlighting Commands

\DeclareRobustCommand{\tcdieroll}[1]{\custhl[soulGreenYellow]{\textbf{#1}}}
\DeclareRobustCommand{\listing}[1]{\custhl[soulGrey]{\ \textbf{#1}\,}}
\DeclareRobustCommand{\tcpage}[1]{\custhl[soulCrimson]{\textbf{Page \pageref{#1}}}}
\DeclareRobustCommand{\chref}[1]{\custhl[soulCrimson]{\textbf{Ch \ref{#1}: \nameref{#1}}}}
\DeclareRobustCommand{\apref}[1]{\custhl[soulCrimson]{\textbf{Ap \ref{#1}: \nameref{#1}}}}
\DeclareRobustCommand{\chpage}[1]{\chref{#1} on \tcpage{#1}}
\DeclareRobustCommand{\appage}[1]{\apref{#1} on \tcpage{#1}}
\DeclareRobustCommand{\measure}[1]{\custhl[soulKhaki]{\textbf{#1}}}
\DeclareRobustCommand{\result}[1]{\custhl[soulCyan]{\textbf{#1}}}
\DeclareRobustCommand{\quip}[1]{\custhl[soulLightGreen]{\textit{#1}}}
\DeclareRobustCommand{\tcdefine}[1]{\custhl[soulDodgerBlue]{\textbf{#1}}}
\DeclareRobustCommand{\example}[1]{\custhl[soulDarkOrange]{\textit{#1}}}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Complex Section Building
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% \skillentry

\DeclareRobustCommand{\skillentry}[6]{%
  \def\skilldie{#5}%
  \def\skillindent{10pt}
  \ifthenelse{\equal{\skilldie}{N/A}}{\def\skilldie{#5}}{\ifthenelse{\equal{\skilldie}{RESERVED}}{\def\skilldie{#5}}{\ifthenelse{\equal{\skilldie}{+0}}{\def\skilldie{#5}}{\def\skilldie{+#5}}}}
  \begin{minipage}{\columnwidth}%
  \noindent\rule{\columnwidth}{1pt}%

  \vspace{5pt}
  \begin{tabularx}{\linewidth}{@{} X r}
  \makecell[lt]{\large\textbf{#1}} & 
  \def\tabcolsep{2pt}
  \footnotesize%
  \begin{tabular}{@{}lrlr}%
  Base Cost & \small\textbf{#4 EP} & Attribute & \small\textbf{#2}\\%
  Skill Type & \small\textbf{#3} & Extra Dice & \small\textbf{\skilldie}\\%
  \midrule%
  \end{tabular}\\%
  \end{tabularx}\\%
  \vspace{2pt}

  #6\\%
  \end{minipage}%
  \vspace{5pt}
  \def\tabcolsep{6pt}
}

%%%% \glossaryentry

\newcommand{\glossaryentry}[2]{%
  \parbox{3cm}{\listing{\indy*{#1}}}%
  \parbox{\linewidth-3cm}{#2}\par
}

%%%% \spellentry

%%%% Name
%%%% Rank
%%%% Time To Cast
%%%% Resist Check
%%%% Target
%%%% Duration
%%%% Area
%%%% Effect
%%%% Description

\DeclareRobustCommand{\spellentry}[9]{%
  \begin{tabularx}{\linewidth}{@{} p{5pt} p{150pt} p{70pt} X}
    \multicolumn{4}{l}{\large\textbf{#2 - \indy{#1}}}\\
    &
    \begin{tabular}[t]{@{}rl}
      Time to Cast: & #3\\
      Resist Check: & #4\\
      Target: & #5\\
      Duration: & #6\\
      Area: & #7\\
      Effect: & #8
    \end{tabular} & &
    #9\\
  \end{tabularx}\\
  %\noindent\rule{\columnwidth}{0.5pt}%
  \vspace{10pt}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Colored Boxes for Tables
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% normbox

\newtcolorbox{normbox}[1][]{ boxrule=0pt, enhanced, title=\small\textbf{#1}, left=1pt, right=1pt, top=0pt, bottom=-2pt, boxsep=2pt, boxrule=0.6pt, before skip=0.0pt, after skip=0.0pt, lefttitle=2pt, righttitle=2mm, toptitle=1mm, bottomtitle=0mm, minipage boxed title, hbox, colbacktitle=Navy, colback=white}

%%%% normboxc

\newtcolorbox{normboxc}[1][]{%
  boxrule=0pt,%
  enhanced,%
  title=\small\textbf{#1},%
  left=1pt,%
  right=1pt,%
  top=0pt,%
  bottom=0pt,%
  boxsep=2pt,%
  boxrule=0.6pt,%
  before skip=0.5\baselineskip,%
  after skip=0.5\baselineskip,%
  lefttitle=2pt,%
  righttitle=2mm,
  toptitle=1mm,%
  bottomtitle=0mm,%
  minipage boxed title,%
  hbox,%
  colbacktitle=Navy,%
  colback=white,%
  before=\hspace*{\fill},%
  after=\hspace*{\fill},%
  }

\newtcolorbox{quotebox}{colback=red!5!white,
colframe=red!75!black}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Misc Functions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%% \bhead

\newcommand{\bhead}[1]{\thead{\textbf{#1}}}

%%%% \mets

\DeclareDocumentCommand \mets {m O{}}{%
  \def\metfeet{\fpeval{#1*2000}}%
  \def\metmi{\fpeval{round(\metfeet/5280,1)}}%
  \def\mikm{\fpeval{round(\metmi*1.609344,1)}}%
  \xintifboolexpr{\metmi>10}{\def\metmir{\fpeval{round(\metmi,0)}}}{\def\metmir{\metmi}}%
  \xintifboolexpr{\mikm>10}{\def\mikmr{\fpeval{round(\mikm,0)}}}{\def\mikmr{\mikm}}%
  \ifthenelse{\equal{#2}{}}{%
    \measure{#1 mets} (\textit{\metmir mi or \mikmr KM})%
  }%
  {%
    \measure{#1 mets} per \ul{#2} (\textit{\metmir mi or \mikmr KM})%
  }%
}

%%%% Make Horizontal Line

\def\makeline{\noindent\rule{\columnwidth}{1pt}}

%%%% Define \aq macro

\def\aq{\textbf{Adventure Quest }}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Begin Document
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{document}
\enlargethispage{1.5\baselineskip}
\titleformat{\chapter}[display] {\normalfont\huge\bfseries}{\chaptertitlename\ \thechapter}{20pt}{\Huge}   
\titlespacing*{\chapter}{0pt}{10pt}{10pt}
\titlespacing\section{0pt}{6pt}{6pt}
\titlespacing\subsection{0pt}{6pt }{6pt}
\titlespacing\subsubsection{0pt}{6pt}{6pt}
%\include{test.tex}
%\begin{comment}
\include{beg-titlepage.tex} %done
\include{beg-copyright.tex} %done
\include{beg-dedication.tex} %done
\include{beg-introduction.tex} %done
\tableofcontents
\include{beg-changes.tex} 
\include{ch-creating-an-adventurer.tex} %done
\include{ch-playing-an-adventurer.tex} %done
\include{ch-life-on-the-high-seas.tex} %done
\include{ch-skills.tex} %done
\include{ch-weapons-armor.tex}
\include{ch-jaern-planet.tex}
\include{ch-onivero.tex}
\include{ch-jaernian-humanoids.tex}
\include{ch-lojem-isle.tex}
\include{ch-rougtero.tex}
\include{ch-marines.tex} %done
\include{ch-auger.tex} %done
\include{ch-nomad.tex}
\include{ch-elem-core.tex} %done
\include{ch-elem-earth.tex}
\include{ch-elem-fire.tex}
\include{ch-elem-air.tex}
\include{ch-elem-water.tex}
\include{ch-divine.tex}
\include{ch-divine-anubis.tex}
\include{ch-divine-atena.tex}
\include{ch-divine-isis.tex}
\include{ch-divine-neptune.tex}
\include{ch-divine-osus.tex}
\include{ch-divine-osiris.tex}
\include{ch-divine-ra.tex}
\include{ch-divine-rudri.tex}
\include{ch-divine-scrogg.tex}
\include{ch-divine-tarus.tex}
\include{ch-divine-tor.tex}
\include{ch-advanced-magic.tex}
\include{ch-magical-items.tex}
\include{ch-creating-and-playing-actors.tex}
\include{ch-actors-rougtero.tex}
\include{ch-creating-creatures.tex}
\include{ch-creatures.tex}
\include{ch-creating-adventures.tex}
\include{ch-judging-adventures.tex}
\addtocontents{toc}{\protect\renewcommand{\protect\cftchappresnum}{Appendix }}
\include{ch-running-campaign.tex}
\appendix
\include{ap-charsheet.tex} %done
\include{ap-glossary.tex}
\include{ap-important-tables.tex}
\include{ap-earth-references.tex}
%\include{index.tex}
%\end{comment}
\printindex
\end{document}